<div class="main-container container">
    <ul class="breadcrumb">
        <li><%= link_to '<i class="fa fa-home"></i>'.html_safe, erp_online_store.root_path %></li>
        <% if !@product.find_menu.nil? %>
            <% @product.find_menu.self_and_parent_menus.each do |menu| %>
                <li><%= link_to menu.name, menu_link(menu) %></li>
            <% end %>
        <% end %>
        <li><%= link_to @product.name, "javascript:void(0)" %></li>
    </ul>
    <div class="row">
        <!--Middle Part Start-->
        <div id="content" class="col-md-12 col-sm-12">
            <div class="product-view row">
                <div class="left-content-product col-lg-12 col-xs-12">
                    <div class="row">                        
                        <div class="content-product-left  col-sm-6 col-xs-12 ">
                            <% if @product.product_images.count > 0 %>
                            <div id="thumb-slider-vertical" class="thumb-vertical-outer">
                                <span class="btn-more prev-thumb nt"><i class="fa fa-chevron-up"></i></span>
                                <span class="btn-more next-thumb nt"><i class="fa fa-chevron-down"></i></span>
                                <ul class="thumb-vertical">
                                    <!-- thumb 600x600 -->
                                    <% @product.product_images.each_with_index do |product_image,index| %>
                                    <li class="owl2-item">
                                        <a data-index="<%= index %>" class="img thumbnail " data-image="<%= product_image.image_url %>" title="<%= @product.name %>">
                                            <%= image_tag product_image.image_url, alt: @product.name, title: @product.name %>
                                        </a>
                                    </li>
                                    <% end %>
                                </ul>
                            </div>
                            <div class="large-image  vertical">                                
                                <img itemprop="image" class="product-image-zoom" src="<%= @product.main_image.image_url %>" data-zoom-image="<%= @product.main_image.image_url %>" title="<%= @product.name %>" alt="<%= @product.name %>">
                            </div>                            
                            <%= link_to '<i class="fa fa-youtube-play"></i>'.html_safe, "https://www.youtube.com/watch?v=HhabgvIIXik", class: "thumb-video pull-left", title: @product.name %>
                            <% else %>
                                Check chưa thêm hình ảnh cho sản phẩm.
                            <% end %>
                        </div>                        
                        <div class="content-product-right col-sm-6 col-xs-12">
                            <div class="title-product">
                                <h1><%= @product.name %></h1>
                            </div>
                            <!-- Review -->
                            <div class="box-review form-group">
                                <div class="ratings">
                                    <div class="rating-box">
                                        <%= raw stars(@product.average_stars) %>
                                    </div>
                                </div>
                                <a class="write_review_button" href="" onclick="$('a[href=\'#tab-review\']').trigger('click'); return false;">Đánh giá sản phẩm</a> | 
                                <a class="write_review_button" href="" onclick="$('a[href=\'#tab-comment\']').trigger('click'); return false;">Bình luận về sản phẩm</a>
                            </div>
                            <div class="product-label form-group">                                
                                <div class="product_page_price price">
                                    <span class="price-new" itemprop="price"><%= format_price(@product.product_price) %></span>
                                    <% if @product.is_deal %>
                                    <span class="price-old"><%= format_price(@product.price) %></span>
                                    <span class="label label-percent">-<%= @product.deal_percent %>%</span>
                                    <% end %>                                    
                                </div>
                            </div>
                            <% if @product.get_product_property_array.count > 0 %>
                            <div class="product-box-desc">
                                <div class="inner-box-desc">
                                    <h3>TÍNH NĂNG SẢN PHẨM</h3>
                                    <% @product.get_product_property_array.each do |product_property| %>
                                    <div>
                                        <span><%= product_property[:name] %>: </span>
                                        <%= product_property[:values].join(", ") %>
                                    </div>
                                    <% end %>
                                </div>
                            </div>
                            <% end %>
                            <div id="product">
                                <h3>ĐẶT MUA SẢN PHẨM</h3>                    
                                <div class="form-group box-info-product">
                                    <%= form_tag erp_online_store.add_to_cart_frontend_cart_items_path, class: 'add-cart-form' do %>
                                        <%= hidden_field_tag "product_id", @product.id %>
                                        <div class="option quantity">
                                            <div class="input-group quantity-control" unselectable="on" style="-webkit-user-select: none;">
                                                <label>Số lượng đặt mua: </label>
                                                <input class="form-control" type="text" name="quantity" value="1">
                                                <span class="input-group-addon product_quantity_down">−</span>
                                                <span class="input-group-addon product_quantity_up">+</span>
                                            </div>
                                        </div>
                                        <div class="cart">
                                            <button class="btn btn-mega btn-lg add-to-cart"><i class="fa fa-cart-plus"></i> Thêm vào giỏ hàng</button>
                                        </div>
                                    <% end %>
                                    <div class="add-to-links wish_comp">
                                        <ul class="blank list-inline">
                                            <li class="compare">
                                                <%= form_tag erp_online_store.add_to_compare_frontend_compare_items_path, class: 'add-compare-form' do %>
                                                    <%= hidden_field_tag "product_id", @product.id %>
                                                    <button class="btn btn-mega add-to-compare" title="So sánh sản phẩm"><i class="fa fa-exchange"></i></button>
                                                <% end %>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!-- end box info product -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="bototm-detail">
                <div class="row">
                    <div class="col-lg-3 col-md-4  col-xs-12">
                        <div class="module releate-horizontal">
                            <%= render "/erp/online_store/frontend/modules/sidebar_best_sellers" %>
                            <%= render "erp/online_store/frontend/modules/hot_banners" %>
                        </div>                        
                    </div>
                    <div class="col-lg-9 col-md-8  col-xs-12">
                        <!-- Product Tabs -->
                        <div class="producttab ">
                            <div class="tabsslider  col-xs-12">
                                <%= render "/erp/online_store/frontend/modules/product/tab_controls", product: @product %>
                            </div>
                        </div>
                        <!-- //Product Tabs -->
                        <!-- Accessory Products -->
                        <div class="related upsell titleLine products-list grid module ">
                            <% if @product.accessory.present? %>
                                <% if @product.accessory.accessory_details.count > 0 %>
                                    <%= render "/erp/online_store/frontend/modules/product/accessories", accessory: @product.accessory %>
                                <% end %>
                            <% end %>
                            <%= render "/erp/online_store/frontend/modules/product/deal_products" %>
                        </div>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                $(document).ready(function() {
                    var zoomCollection = '.large-image img';
                    $(zoomCollection).elevateZoom({
                        zoomType: "inner",
                        lensSize: "200",
                        easing: true,
                        gallery: 'thumb-slider-vertical',
                        cursor: 'pointer',
                        galleryActiveClass: "active"
                    });
                    $('.large-image').magnificPopup({
                        items: [{
                                src: '/frontend/image/shop/product/1.png'
                            },
                            {
                                src: '/frontend/image/shop/product/f9.jpg'
                            },
                            {
                                src: '/frontend/image/shop/product/2.png'
                            },
                            {
                                src: '/frontend/image/shop/product/3.png'
                            },
                            {
                                src: '/frontend/image/shop/product/j9.jpg'
                            },
                        ],
                        gallery: {
                            enabled: true,
                            preload: [0, 2]
                        },
                        type: 'image',
                        mainClass: 'mfp-fade',
                        callbacks: {
                            open: function() {
                                var activeIndex = parseInt($('#thumb-slider-vertical .img.active').attr('data-index'));
                                var magnificPopup = $.magnificPopup.instance;
                                magnificPopup.goTo(activeIndex);
                            }
                        }
                    });
                    $("#thumb-slider-vertical .owl2-item").each(function() {
                        $(this).find("[data-index='0']").addClass('active');
                    });

                    $('.thumb-video').magnificPopup({
                        type: 'iframe',
                        iframe: {
                            patterns: {
                                youtube: {
                                    index: 'youtube.com/', // String that detects type of video (in this case YouTube). Simply via url.indexOf(index).
                                    id: 'v=', // String that splits URL in a two parts, second part should be %id%
                                    src: '//www.youtube.com/embed/%id%?autoplay=1' // URL that will be set as a source for iframe. 
                                },
                            }
                        }
                    });

                    $('.product-options li.radio').click(function() {
                        $(this).addClass(function() {
                            if ($(this).hasClass("active")) return "";
                            return "active";
                        });

                        $(this).siblings("li").removeClass("active");
                        $(this).parent().find('.selected-option').html('<span class="label label-success">' + $(this).find('img').data('original-title') + '</span>');
                    });

                    var _isMobile = {
                        iOS: function() {
                            return navigator.userAgent.match(/iPhone/i);
                        },
                        any: function() {
                            return (_isMobile.iOS());
                        }
                    };

                    $(".thumb-vertical-outer .next-thumb").click(function() {
                        $(".thumb-vertical-outer .lSNext").trigger("click");
                    });

                    $(".thumb-vertical-outer .prev-thumb").click(function() {
                        $(".thumb-vertical-outer .lSPrev").trigger("click");
                    });

                    $(".thumb-vertical-outer .thumb-vertical").lightSlider({
                        item: 4,
                        autoWidth: false,
                        vertical: true,
                        slideMargin: 7,
                        verticalHeight: 425,
                        pager: false,
                        controls: true,
                        prevHtml: '<i class="fa fa-chevron-up"></i>',
                        nextHtml: '<i class="fa fa-chevron-down"></i>',
                        responsive: [{
                                breakpoint: 1199,
                                settings: {
                                    verticalHeight: 330,
                                    item: 4,
                                }
                            },
                            {
                                breakpoint: 1024,
                                settings: {
                                    verticalHeight: 235,
                                    item: 2,
                                    slideMargin: 5,
                                }
                            },
                            {
                                breakpoint: 768,
                                settings: {
                                    verticalHeight: 340,
                                    item: 3,
                                }
                            },
                            {
                                breakpoint: 480,
                                settings: {
                                    verticalHeight: 100,
                                    item: 1,
                                }
                            }
                        ]
                    });
                    // Product detial reviews button
                    $(".reviews_button,.write_review_button").click(function() {
                        var tabTop = $(".producttab").offset().top;
                        $("html, body").animate({
                            scrollTop: tabTop
                        }, 1000);
                    });
                });
            </script>
        </div>
    </div>
    <!--Middle Part End-->
</div>